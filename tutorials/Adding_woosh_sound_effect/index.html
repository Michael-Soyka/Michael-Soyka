<!DOCTYPE html>
<html>
<head>
	<title>Adding woosh sound effect</title>
	<meta property="og:title" content="Adding woosh sound effect">
	<meta name="author" content="M. Soyka">
	<meta property="og:locale" content="ru_RU">
	<meta property="og:site_name" content="Adding woosh sound effect">
	<meta name="twitter:card" content="summary">
	<meta property="twitter:title" content="Adding woosh sound effect">

	<link rel="stylesheet" href="css/main.css">

	<link rel="stylesheet" title="theme" href="#">
	
</head>
<body>

	<a class="lang-switch" href="./index_en.html"> <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35" fill="#000000" viewBox="0 0 20 20"> <path d="M1.5 19c-0.276 0-0.5-0.224-0.5-0.5v-15c0-0.276 0.224-0.5 0.5-0.5s0.5 0.224 0.5 0.5v15c0 0.276-0.224 0.5-0.5 0.5z"></path> <path d="M3.5 10c-0.104 0-0.21-0.033-0.3-0.1-0.221-0.166-0.266-0.479-0.1-0.7 0.067-0.090 1.676-2.2 3.9-2.2 1.694 0 2.813 0.599 3.801 1.127 0.875 0.468 1.631 0.873 2.699 0.873 2.192 0 3.758-2.080 4.65-3.718-0.698 0.397-1.59 0.718-2.65 0.718-2.207 0-3.347-1.14-4.354-2.146-0.995-0.995-1.854-1.854-3.646-1.854-2.224 0-3.587 1.782-3.6 1.8-0.166 0.221-0.479 0.266-0.7 0.1s-0.266-0.479-0.1-0.7c0.067-0.090 1.681-2.2 4.4-2.2 2.207 0 3.347 1.14 4.354 2.146 0.995 0.995 1.854 1.854 3.646 1.854 2.224 0 3.587-1.782 3.6-1.8 0.147-0.196 0.415-0.257 0.632-0.143s0.32 0.368 0.242 0.601c-0.021 0.064-0.533 1.581-1.558 3.119-0.612 0.918-1.282 1.653-1.991 2.185-0.918 0.688-1.902 1.037-2.925 1.037-1.318 0-2.26-0.504-3.171-0.991-0.97-0.519-1.886-1.009-3.329-1.009-1.73 0-3.087 1.782-3.1 1.8-0.098 0.131-0.248 0.2-0.4 0.2z"></path> </svg></a>

	<div class="theme-switch">
		<svg class="changeTheme" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" data-theme="light" width="35" height="35" fill="#fff" viewBox="0 0 20 20" style="display: none;"> <path d="M9.5 14.993c-2.477 0-4.493-2.015-4.493-4.493s2.015-4.493 4.493-4.493 4.493 2.015 4.493 4.493-2.015 4.493-4.493 4.493zM9.5 7.007c-1.926 0-3.493 1.567-3.493 3.493s1.567 3.493 3.493 3.493 3.493-1.567 3.493-3.493-1.567-3.493-3.493-3.493z"></path> <path d="M9.5 5c-0.276 0-0.5-0.224-0.5-0.5v-3c0-0.276 0.224-0.5 0.5-0.5s0.5 0.224 0.5 0.5v3c0 0.276-0.224 0.5-0.5 0.5z"></path> <path d="M9.5 20c-0.276 0-0.5-0.224-0.5-0.5v-3c0-0.276 0.224-0.5 0.5-0.5s0.5 0.224 0.5 0.5v3c0 0.276-0.224 0.5-0.5 0.5z"></path> <path d="M3.5 11h-3c-0.276 0-0.5-0.224-0.5-0.5s0.224-0.5 0.5-0.5h3c0.276 0 0.5 0.224 0.5 0.5s-0.224 0.5-0.5 0.5z"></path> <path d="M18.5 11h-3c-0.276 0-0.5-0.224-0.5-0.5s0.224-0.5 0.5-0.5h3c0.276 0 0.5 0.224 0.5 0.5s-0.224 0.5-0.5 0.5z"></path> <path d="M4.5 6c-0.128 0-0.256-0.049-0.354-0.146l-2-2c-0.195-0.195-0.195-0.512 0-0.707s0.512-0.195 0.707 0l2 2c0.195 0.195 0.195 0.512 0 0.707-0.098 0.098-0.226 0.146-0.354 0.146z"></path> <path d="M2.5 18c-0.128 0-0.256-0.049-0.354-0.146-0.195-0.195-0.195-0.512 0-0.707l2-2c0.195-0.195 0.512-0.195 0.707 0s0.195 0.512 0 0.707l-2 2c-0.098 0.098-0.226 0.146-0.354 0.146z"></path> <path d="M16.5 18c-0.128 0-0.256-0.049-0.354-0.146l-2-2c-0.195-0.195-0.195-0.512 0-0.707s0.512-0.195 0.707 0l2 2c0.195 0.195 0.195 0.512 0 0.707-0.098 0.098-0.226 0.146-0.354 0.146z"></path> <path d="M14.5 6c-0.128 0-0.256-0.049-0.354-0.146-0.195-0.195-0.195-0.512 0-0.707l2-2c0.195-0.195 0.512-0.195 0.707 0s0.195 0.512 0 0.707l-2 2c-0.098 0.098-0.226 0.146-0.354 0.146z"></path> </svg>
		<svg class="changeTheme" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" data-theme="dark"  width="35" height="35" fill="#000" viewBox="0 0 20 20" style="display: block;"> <path d="M9.5 14.993c-2.477 0-4.493-2.015-4.493-4.493s2.015-4.493 4.493-4.493 4.493 2.015 4.493 4.493-2.015 4.493-4.493 4.493zM9.5 7.007c-1.926 0-3.493 1.567-3.493 3.493s1.567 3.493 3.493 3.493 3.493-1.567 3.493-3.493-1.567-3.493-3.493-3.493z"></path> <path d="M9.5 5c-0.276 0-0.5-0.224-0.5-0.5v-3c0-0.276 0.224-0.5 0.5-0.5s0.5 0.224 0.5 0.5v3c0 0.276-0.224 0.5-0.5 0.5z"></path> <path d="M9.5 20c-0.276 0-0.5-0.224-0.5-0.5v-3c0-0.276 0.224-0.5 0.5-0.5s0.5 0.224 0.5 0.5v3c0 0.276-0.224 0.5-0.5 0.5z"></path> <path d="M3.5 11h-3c-0.276 0-0.5-0.224-0.5-0.5s0.224-0.5 0.5-0.5h3c0.276 0 0.5 0.224 0.5 0.5s-0.224 0.5-0.5 0.5z"></path> <path d="M18.5 11h-3c-0.276 0-0.5-0.224-0.5-0.5s0.224-0.5 0.5-0.5h3c0.276 0 0.5 0.224 0.5 0.5s-0.224 0.5-0.5 0.5z"></path> <path d="M4.5 6c-0.128 0-0.256-0.049-0.354-0.146l-2-2c-0.195-0.195-0.195-0.512 0-0.707s0.512-0.195 0.707 0l2 2c0.195 0.195 0.195 0.512 0 0.707-0.098 0.098-0.226 0.146-0.354 0.146z"></path> <path d="M2.5 18c-0.128 0-0.256-0.049-0.354-0.146-0.195-0.195-0.195-0.512 0-0.707l2-2c0.195-0.195 0.512-0.195 0.707 0s0.195 0.512 0 0.707l-2 2c-0.098 0.098-0.226 0.146-0.354 0.146z"></path> <path d="M16.5 18c-0.128 0-0.256-0.049-0.354-0.146l-2-2c-0.195-0.195-0.195-0.512 0-0.707s0.512-0.195 0.707 0l2 2c0.195 0.195 0.195 0.512 0 0.707-0.098 0.098-0.226 0.146-0.354 0.146z"></path> <path d="M14.5 6c-0.128 0-0.256-0.049-0.354-0.146-0.195-0.195-0.195-0.512 0-0.707l2-2c0.195-0.195 0.512-0.195 0.707 0s0.195 0.512 0 0.707l-2 2c-0.098 0.098-0.226 0.146-0.354 0.146z"></path> </svg>
	</div>

	<div class="global-block">
		<div class="middle-block">
			<div id="header">
			</div>
			<p>Добавление woosh</p>

			<div id="text">
				Открываем hl2_player.cpp<br>
				Вписываем над "DEFINE_SOUNDPATCH( m_sndLeeches ),"
				<div id="text-command">
                    <div id="text-command-div">DEFINE_SOUNDPATCH(m_pWooshSound),</div>
                </div>
				Добавим его определение в хэдер "hl2_player.h". Объявите наш "m_pWooshSound" в разделе "private:"
				<div id="text-command">
                    <div id="text-command-div">CSoundPatch		*m_pWooshSound;</div>
                </div>
				Подготовим место под наши функции. В хэдер "hl2_player.h" ниже виртуального типа "OnRestore();" пишем
				<div id="text-command">
                    <div id="text-command-div">
virtual void		CreateSounds(void);
void				UpdateWoosh(void);
</div>
                </div>
				Теперь прямо над "void CHL2_Player::StopLoopingSounds( void )" вписываем<br>
				<div id="text-command">
                    <div id="text-command-div">
//-----------------------------------------------------------------------------
// Creating Sound
//-----------------------------------------------------------------------------

void CHL2_Player::CreateSounds()
{
	if (!m_pWooshSound)
	{
		CSoundEnvelopeController &controller = CSoundEnvelopeController::GetController();
		CPASAttenuationFilter filter(this);
		m_pWooshSound = controller.SoundCreate(filter, entindex(), "HL2Player.Woosh");
		controller.Play(m_pWooshSound, 0, 100);
	}					
}
</div>
                </div>
				Теперь заставляем работать наш "CreateSounds". Внутри "Spawn(void)" ниже "BaseClass::Spawn();" добавляем<br>
				<div id="text-command">
                    <div id="text-command-div">CreateSounds();</div>
                </div>
				И теперь делаем пре-кэш звука. Внутри "void CHL2_Player::Precache( void )" пишем
				<div id="text-command">
                    <div id="text-command-div">PrecacheScriptSound("HL2Player.Woosh");</div>
                </div>
				(Этого небыло в видео) Не забываем останавливать наш звук.<br>
				Внутри "void CHL2_Player::StopLoopingSounds( void )" в самом начале вписываем
				<div id="text-command">
                    <div id="text-command-div">
if (m_pWooshSound)
{
	CSoundEnvelopeController &controller = CSoundEnvelopeController::GetController();
	controller.SoundDestroy(m_pWooshSound);
	m_pWooshSound = NULL;
}
</div>
                </div>
				Добавляем обновление громкости нашего звука<br>
				<div id="text-command">
                    <div id="text-command-div">
void CHL2_Player::UpdateWoosh(void)
{
	if (m_pWooshSound)
	{
		CSoundEnvelopeController &controller = CSoundEnvelopeController::GetController();
		float fWooshVol = GetAbsVelocity().Length() - MIN_WOOSH_SPEED;
		if (fWooshVol < 0.0f)
		{
			controller.SoundChangeVolume(m_pWooshSound, 0.0f, 0.1f);
			return;
		}

		fWooshVol /= 2000.0f;
		if (fWooshVol > 1.0f)
			fWooshVol = 1.0f;

		controller.SoundChangeVolume(m_pWooshSound, fWooshVol, 0.1f);
	}
}
</div>
				</div>
				Теперь заставляем его работать. Внутри "void CHL2_Player::PostThink( void )" пишем  
				<div id="text-command">
                    <div id="text-command-div">UpdateWoosh();</div>
                </div>
				Также нужно определить наш "MIN_WOOSH_SPEED". Открываем хэдер "hl2_shareddefs.h" и вписываем 
				<div id="text-command">
                    <div id="text-command-div">#define MIN_FLING_SPEED 750</div>
                </div>
				На этом этапе с кодом покончено. Компилируем и приступаем к самой игре.<br>
				После компиляции перекидываем библиотеки client и server в наш мод.<br>
				Создаем директорию sound и кладем туда наш файл со <a target="_blank" rel="noopener noreferrer" href="https://raw.githubusercontent.com/Michael-Soyka/Michael-Soyka/main/tutorials/Adding_woosh_sound_effect/files/woosh.wav">звуком ветра</a>.<br>
				Далее в директории "scripts" создаем файл "game_sounds_mymod.txt" и вписываем в него
				<div id="text-command">
                    <div id="text-command-div">
"HL2Player.Woosh"
{
	"channel" "CHAN_STATIC"
	"volume" "1.00"
	"soundlevel" "SNDLVL_85dB"
	"pitch" "100"
	"wave" "woosh.wav"	
}
</div>
				</div>
				Далее, вам нужен файл "game_sounds_manifest.txt" от той игры под которую вы делаете ваш мод, в моей случае это "HL2:EP2" и файл я беру его от туда. <br>
				Добавляем в этот файл пре-кэш нашего нового файла со звуками.
				<div id="text-command">
                    <div id="text-command-div">	"precache_file"		"scripts/game_sounds_mymod.txt"</div>
                </div>
				На этом все.
			</div>
		</div>
	</div>
	<script src="js/main.js"></script>
</body>
</html>